---
title: "CraftBukkitã‚’åˆ©ç”¨ã—ãŸSpigotã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã‚’ã—ã‚ˆã†"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["minecraft", "spigot", "craftbukkit"]
published: true
---

## CraftBukkitã‚’åˆ©ç”¨ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆ

CraftBukkitã‚’åˆ©ç”¨ã™ã‚‹ã¨ã„ã†ã“ã¨ã¯ã€$\textcolor{blue}{ã‚µãƒ¼ãƒãƒ¼ãã®ã‚‚ã®ã®ä»•çµ„ã¿ã‚’ã¤ã‹ã£ã¦ã„ã‚‹}$ ã“ã¨ã«ãªã‚‹ã€‚ãã®ãŸã‚ã€ãƒ–ãƒ­ãƒƒã‚¯ã‚’å£Šã—ãŸå ´åˆãªã©ã« $\textcolor{red}{çŠ¶æ…‹ã‚„å‰¯ä½œç”¨ã‚’è€ƒãˆã‚‹å¿…è¦ãŒãªã„}$ã€‚

ä¾‹ãˆã°ã€ãƒ–ãƒ­ãƒƒã‚¯ã‚’å£Šã—ãŸå ´åˆã«ã¯æ¬¡ã®ã‚ˆã†ãªã“ã¨ã‚’è€ƒãˆã‚‹å¿…è¦ãŒãªããªã‚‹ã€‚

- é“å…·ã®è€ä¹…å€¤
- é“å…·ã®ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆï¼ˆè€ä¹…ã€å¹¸é‹ã€ã‚·ãƒ«ã‚¯ã‚¿ãƒƒãƒã€etc...ï¼‰
- ãƒ‰ãƒ­ãƒƒãƒ—ã‚„çµŒé¨“å€¤ã‚ªãƒ¼ãƒ–
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµ±è¨ˆæƒ…å ±
- Eventã®å†ç™ºè¡Œ
- ä»–ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã®å…¼ã­åˆã„
- etc...

## å¿…è¦ãªæº–å‚™

### craftbukkit-*.jarã‚’ç”Ÿæˆã™ã‚‹

BuildTools.jarã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã `--compile craftbukkit` ã‚’æŒ‡å®šã™ã‚‹ã€‚

```shell
java -jar BuildTools.jar --rev 1.19 --compile craftbukkit
```

ã™ã‚‹ã¨ `craftbukkit-1.19-R0.1-SNAPSHOT.jar` ãŒ `./CraftBukkit/target/` ã«ç”Ÿæˆã•ã‚Œã‚‹ã®ã§ã€ã“ã‚Œã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦èª­ã¿è¾¼ã‚ã°CraftBukkitã®ã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã—ãŸé–‹ç™ºãŒã§ãã‚‹ã€‚

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§èª­ã¿è¾¼ã‚€

é–‹ç™ºã—ã¦ã„ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã« `libs` ç­‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½åŠ ã—ã€ãã“ã«ç”Ÿæˆã—ãŸ `craftbukkit-1.19-R0.1-SNAPSHOT.jar` ã‚’ãŠãã€`build.gradle` ã§æ¬¡ã®ã‚ˆã†ã«èª­ã¿è¾¼ã‚€ã€‚

```groovy:build.gradle
dependencies {
    compileOnly fileTree(dir: 'libs', include: ['*.jar'])
    ...
}
```

ã“ã‚Œã‚’å®Ÿéš›ã«ã¤ã‹ã†ã¨æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã‚‹ã€‚

```kotlin
...
// ã‚²ãƒ¼ãƒ ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦importå…ˆãŒç•°ãªã‚‹
import org.bukkit.craftbukkit.v1_19_R1.CraftWorld
import org.bukkit.craftbukkit.v1_19_R1.entity.CraftPlayer
import org.bukkit.craftbukkit.v1_19_R1.inventory.CraftItemStack
...

// æ—¢å­˜ã®ä»•çµ„ã¿ã‚’ã¤ã‹ã£ã¦ãƒ–ãƒ­ãƒƒã‚¯ã‚’å£Šã™
fun breakBlock(player: Player, block: Block) {
    val craftPlayer = player as CraftPlayer
    val blockPosition = BlockPosition(block.x, block.y, block.z)
    craftPlayer.handle.d.a(blockPosition)
}

// æ—¢å­˜ã®ä»•çµ„ã¿ã‚’ã¤ã‹ã£ã¦çµŒé¨“å€¤ã‚ªãƒ¼ãƒ–ã‚’ã ã™
fun dropExperience(player: Player, amount: Int) {
    val world = (player.world as CraftWorld).handle
    val expEntity = EntityExperienceOrb(...)
    world.addFreshEntity(expEntity, CreatureSpawnEvent.SpawnReason.DEFAULT)
}
```

## åœ§ç¸®ã•ã‚ŒãŸCraftBukkitã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã¿ã‹ãŸ

å…¬å¼ã®ãƒªãƒã‚¸ãƒˆãƒªã§åœ§ç¸®å‰ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚ˆã‚€ã€‚

https://hub.spigotmc.org/stash/projects/SPIGOT/repos/craftbukkit/browse/src/main/java/org/bukkit/craftbukkit

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§èª¿ã¹ãŸã‚ã¨ã¯Kotlinã®æ‹¡å¼µé–¢æ•°ã‚„æ‹¡å¼µãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦å®šç¾©ã—ã¦ãŠãã“ã¨ã§åˆ©ç”¨ã—ã‚„ã™ãã—ã¦ãŠãã¨è‰¯ã„ã€‚

https://github.com/m4kvn/spigot-miner/blob/master/src/main/java/com/m4kvn/spigot/miner/nms/NMS_Utils.kt#L13-L38

